apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Note: Do NOT set namespace here. Resources have explicit namespaces:
# - ClusterIssuer: cluster-scoped
# - wildcard certs: cert-manager
# - default-ingress cert + configmap: kube-system (avoids conflict with wildcard-dataknife-net secretName)
#
# This is the ONLY cluster that requests certificates from Let's Encrypt.
# TLS secrets are synced to downstream clusters via scripts/sync-certs-from-rancher-manager.sh
# This reduces Let's Encrypt certificate requests from 8 (4 clusters Ã— 2 certs) to just 2.
# Note: We only request wildcard-dataknife-net once; the secret is copied to kube-system
# for default ingress (avoids duplicate requests for the same DNS names).
resources:
  # Override ClusterIssuer with DNS provider configuration
  - clusterissuer.yaml
  # Certificate resources (only cluster requesting from Let's Encrypt)
  # Note: We only request one certificate for *.dataknife.net; the secret is copied
  # to kube-system for default ingress via the sync script
  - certificate-wildcard-dataknife-net.yaml
  - certificate-wildcard-dataknife-ai.yaml
  # ConfigMap for nginx-ingress default SSL cert (references secret copied by sync script)
  - configmap-default-cert.yaml
  # Certificate sync automation (CronJob to sync certs to downstream clusters)
  - serviceaccount-cert-sync.yaml
  - configmap-cert-sync-script.yaml
  - cronjob-cert-sync.yaml

commonLabels:
  app: cert-manager
  managed-by: gitops
